<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>üìä Admin Dashboard</ion-title>
    
    <ion-buttons slot="end">
      <ion-button fill="clear" (click)="logout()" title="Logout" color="light">
        <ion-icon name="log-out-outline"></ion-icon>
        Logout
      </ion-button>

      <ion-avatar>
        <img [src]="userProfileUrl" alt="Admin" />
      </ion-avatar>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding dashboard-bg">

  <!-- Admin Welcome Section -->
  <div class="intro-text">
    <h2>Welcome Back, {{ userName }}! üë®‚Äçüíº</h2>
    <span>
      Monitor all books across different states, view statistics, and manage the decentralized book exchange platform.
    </span>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-container">
    <ion-card class="stat-card">
      <ion-card-content>
        <div class="stat-content">
          <ion-icon name="people-outline" class="stat-icon"></ion-icon>
          <div>
            <h3>{{ totalUsers }}</h3>
            <p>Total Users</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card class="stat-card">
      <ion-card-content>
        <div class="stat-content">
          <ion-icon name="book-outline" class="stat-icon"></ion-icon>
          <div>
            <h3>{{ totalBooks }}</h3>
            <p>Total Books</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card class="stat-card">
      <ion-card-content>
        <div class="stat-content">
          <ion-icon name="location-outline" class="stat-icon"></ion-icon>
          <div>
            <h3>{{ locations.length - 1 }}</h3>
            <p>Active States</p>
          </div>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Books by State Breakdown -->
  <ion-card class="breakdown-card">
    <ion-card-header>
      <ion-card-title>üìç Books Distribution by State</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="state-stats">
        <div class="state-item" *ngFor="let location of locations">
          <span class="location-name" *ngIf="location !== 'All'">{{ location }}</span>
          <span class="book-count" *ngIf="location !== 'All'">{{ booksByState[location] || 0 }} books</span>
        </div>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- Filter Section -->
  <div class="filter-section">
    <ion-card>
      <ion-card-content>
        <div class="filter-content">
          <ion-label class="filter-label">Filter by Location:</ion-label>
          <ion-select [(ngModel)]="selectedLocation" (ionChange)="onLocationChange()" interface="popover" placeholder="Select State">
            <ion-select-option *ngFor="let location of locations" [value]="location">
              {{ location }}
            </ion-select-option>
          </ion-select>
        </div>
      </ion-card-content>
    </ion-card>
  </div>

  <!-- Featured Books Slider -->
  <div class="book-slider-section" *ngIf="books && books.length">
    <h2 class="text-center mb-3 bg-success text-white p-2 rounded">üî• Featured Books</h2>

    <div class="swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide" *ngFor="let book of books">
          <ion-card class="book-card">
            <img [src]="book.image" alt="{{ book.title }}" class="book-img" />
            <ion-card-header>
              <ion-card-title>{{ book.title }}</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <p><strong>Author:</strong> {{ book.author }}</p>
              <p><strong>Price:</strong> {{ book.price }}</p>
            </ion-card-content>
          </ion-card>
        </div>
      </div>
      
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
  </div>

  <!-- All Books Grid (Filtered) -->
  <div class="books-section">
    <h2 class="section-title">
      üìö All Books 
      <span *ngIf="selectedLocation !== 'All'"> in {{ selectedLocation }}</span>
      <span class="book-count-badge">{{ displayedBooks.length }}</span>
    </h2>

    <div class="book-grid">
      <ion-card class="book-card-detailed" *ngFor="let book of displayedBooks">
        <div class="book-badge">{{ book.location }}</div>
        <img [src]="book.image" alt="{{ book.title }}" class="book-img"/>
        <ion-card-header>
          <ion-card-title>{{ book.title }}</ion-card-title>
          <ion-card-subtitle>{{ book.author }}</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <div class="book-details">
            <p><ion-icon name="person-outline"></ion-icon> <strong>Owner:</strong> {{ book.owner }}</p>
            <p><ion-icon name="location-outline"></ion-icon> <strong>Location:</strong> {{ book.location }}</p>
            <p class="price"><ion-icon name="pricetag-outline"></ion-icon> <strong>Price:</strong> {{ book.price }}</p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <!-- Bootstrap Carousel Section -->
  <div class="carousel-container mt-4">
    <h2 class="text-center mb-3 bg-success text-white p-2 rounded">üìö Best Selling Books</h2>
    <div id="bookCarousel" class="carousel slide" data-bs-ride="carousel">
      
      <div class="carousel-indicators">
        <button type="button" data-bs-target="#bookCarousel" data-bs-slide-to="0" class="active" aria-current="true"></button>
        <button type="button" data-bs-target="#bookCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#bookCarousel" data-bs-slide-to="2"></button>
      </div>

      <div class="carousel-inner">
        <div class="carousel-item active">
          <img src="assets/harry_potter.jpg" class="d-block w-100" alt="Harry Potter">
          <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
            <h5>Harry Potter and the Sorcerer's Stone</h5>
            <p>Author: J.K. Rowling | Price: $25</p>
          </div>
        </div>
        <div class="carousel-item">
          <img src="assets/youcandoit.jpg" class="d-block w-100" alt="You Can Do It">
          <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
            <h5>You Can Do It</h5>
            <p>Author: Dr. A.P.J. Abdul Kalam | Price: $15</p>
          </div>
        </div>
        <div class="carousel-item">
          <img src="assets/darkpsychology.jpg" class="d-block w-100" alt="Dark Psychology">
          <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
            <h5>Dark Psychology</h5>
            <p>Author: Dr. Shefali | Price: $22</p>
          </div>
        </div>
      </div>

      <button class="carousel-control-prev" type="button" data-bs-target="#bookCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button class="carousel-control-next" type="button" data-bs-target="#bookCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>

    </div>
  </div>

</ion-content>